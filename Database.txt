-- Create Database
CREATE DATABASE IF NOT EXISTS attendance_system;
USE attendance_system;
-- Create Users table
CREATE TABLE IF NOT EXISTS users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('ADMIN', 'TEACHER') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
-- Create Courses table
CREATE TABLE IF NOT EXISTS courses (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    assigned_teacher_id BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (assigned_teacher_id) REFERENCES users(id) ON DELETE SET NULL
);
-- Create Students table
CREATE TABLE IF NOT EXISTS students (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100),
    course_id BIGINT,
    teacher_id BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (course_id) REFERENCES courses(id) ON DELETE SET NULL,
    FOREIGN KEY (teacher_id) REFERENCES users(id) ON DELETE SET NULL
);
-- Create Attendance table
CREATE TABLE IF NOT EXISTS attendance (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    student_id BIGINT NOT NULL,
    date DATE NOT NULL,
    status ENUM('PRESENT', 'ABSENT') NOT NULL,
    marked_by BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,
    FOREIGN KEY (marked_by) REFERENCES users(id) ON DELETE SET NULL,
    UNIQUE KEY unique_student_date (student_id, date)
);
-- Insert sample data
-- Insert admin user (password: admin123)
INSERT INTO users (username, password, role) VALUES 
('admin', '$2a$10$K.zZ.2QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU', 'ADMIN');
-- Insert teacher user (password: teacher123)
INSERT INTO users (username, password, role) VALUES 
('teacher1', '$2a$10$K.zZ.2QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU3QQQ0oU', 'TEACHER');

-- Insert courses
INSERT INTO courses (name, assigned_teacher_id) VALUES 
('Computer Science', 2),
('Mathematics', 2);
-- Insert students
INSERT INTO students (name, email, course_id, teacher_id) VALUES 
('John Doe', 'john@example.com', 1, 2),
('Jane Smith', 'jane@example.com', 1, 2),
('Bob Johnson', 'bob@example.com', 2, 2),
('Alice Brown', 'alice@example.com', 2, 2);

ALTER TABLE attendance 
MODIFY COLUMN status ENUM('PRESENT', 'ABSENT', 'LATE', 'LEAVE') NOT NULL;
SELECT * from attendance;
select * from students;